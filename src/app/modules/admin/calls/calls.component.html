<div class="flex flex-col flex-auto min-w-0">
	<!-- Main -->
	<div class="flex-auto p-6 sm:p-10">
		<!-- Configuration Section -->
		<div class="flex-auto max-w-3xl">
			<div>
				<div class="text-3xl font-semibold tracking-tight leading-8">Calls</div>
				<div class="font-medium tracking-tight text-secondary">View and analyze calls.</div>
			</div>
		</div>
		<!-- <div class="flex flex-col gap-6"> -->
		<form class="grid grid-cols-1 md:grid-cols-5 gap-3 mb-4 mt-8" (ngSubmit)="$event.preventDefault(); applyFilters()">
			<div>
				<label class="block text-xs mb-1">From</label>
				<input type="date" class="w-full border rounded p-2" [(ngModel)]="from" name="from" />
			</div>
			<div>
				<label class="block text-xs mb-1">To</label>
				<input type="date" class="w-full border rounded p-2" [(ngModel)]="to" name="to" />
			</div>
			<div>
				<label class="block text-xs mb-1">Agent</label>
				<select class="w-full border rounded p-2" [(ngModel)]="agentId" name="agentId">
				<option value="">All</option>
				<option *ngFor="let a of agents()" [value]="a.id">{{ a.name }}</option>
				</select>
			</div>
			<div>
				<label class="block text-xs mb-1">Workspace</label>
				<select class="w-full border rounded p-2" [(ngModel)]="workspaceId" name="workspaceId">
				<option value="">Current</option>
				<option *ngFor="let w of workspaces()" [value]="w.id">{{ w.name }}</option>
				</select>
			</div>
			<div class="flex items-end">
				<button class="px-3 py-2 rounded bg-primary text-white" type="submit">Apply</button>
			</div>
		</form>
		<div *ngIf="errorMsg() as err" class="mb-3 p-3 rounded border border-red-200 bg-red-50 text-red-700 text-sm">{{ err }}</div>
		<table class="w-full" *ngIf="loading()">
			<thead>
				<tr>
					<th class="text-left p-2">Ended</th>
					<th class="text-left p-2">Agent</th>
					<th class="text-left p-2">Duration</th>
					<th class="text-left p-2">Turns</th>
					<th class="text-left p-2">Metrics</th>
				</tr>
			</thead>
			<tbody>
				<tr *ngFor="let _ of [0,1,2,3,4]" class="animate-pulse">
					<td class="p-2">
						<div class="h-4 w-32 bg-gray-200 rounded"></div>
					</td>
					<td class="p-2">
						<div class="h-4 w-24 bg-gray-200 rounded"></div>
					</td>
					<td class="p-2">
						<div class="h-4 w-16 bg-gray-200 rounded"></div>
					</td>
					<td class="p-2">
						<div class="h-4 w-10 bg-gray-200 rounded"></div>
					</td>
					<td class="p-2">
						<div class="h-4 w-24 bg-gray-200 rounded"></div>
					</td>
				</tr>
			</tbody>
		</table>
		<table *ngIf="!loading()" class="w-full">
			<thead>
				<tr>
					<th class="text-left p-2">Ended</th>
					<th class="text-left p-2">Agent</th>
					<th class="text-left p-2">Duration</th>
					<th class="text-left p-2">Turns</th>
					<th class="text-left p-2">Metrics</th>
				</tr>
			</thead>
			<tbody>
				<tr *ngFor="let c of calls()" [routerLink]="['/calls', c.id]" class="hover:bg-gray-50 cursor-pointer">
				<td class="p-2">{{ c.ended_at | date:'medium' }}</td>
				<td class="p-2">{{ c.agent?.name || c.agent_id }}</td>
				<td class="p-2">{{ c.duration_ms/1000 | number:'1.0-0' }}s</td>
				<td class="p-2">{{ c.turns_count }}</td>
				<td class="p-2 space-x-1">
					<span class="inline-block px-2 py-0.5 rounded text-xs" [class.bg-green-100]="hasKeys(c.metrics_stt)" [class.bg-gray-100]="!hasKeys(c.metrics_stt)">STT</span>
					<span class="inline-block px-2 py-0.5 rounded text-xs" [class.bg-green-100]="hasKeys(c.metrics_llm)" [class.bg-gray-100]="!hasKeys(c.metrics_llm)">LLM</span>
					<span class="inline-block px-2 py-0.5 rounded text-xs" [class.bg-green-100]="hasKeys(c.metrics_tts)" [class.bg-gray-100]="!hasKeys(c.metrics_tts)">TTS</span>
				</td>
				</tr>
			</tbody>
		</table>
		<div class="mt-3 flex items-center gap-2" *ngIf="!loading()">
			<button class="px-2 py-1 border rounded" (click)="prevPage()" [disabled]="page<=1">Prev</button>
			<span>Page {{ page }}</span>
			<button class="px-2 py-1 border rounded" (click)="nextPage()">Next</button>
		</div>
	</div>
</div>