<div class="flex flex-col flex-auto min-w-0">
    <!-- Main -->
    <div class="flex-auto p-6 sm:p-10">
        <!-- Header -->
        <div class="flex items-center justify-between w-full">
            <div>
                <div class="text-3xl font-semibold tracking-tight leading-8">User Management</div>
                <div class="font-medium tracking-tight text-secondary">Manage users and their roles in the system.</div>
            </div>
            <!-- Actions -->
            <div class="flex items-center gap-2">
                <button
                    mat-flat-button
                    [color]="'primary'"
                    *hasPermission="'create_user'"
                    (click)="openUserDialog()">
                    <mat-icon [svgIcon]="'heroicons_outline:plus'"></mat-icon>
                    <span class="ml-2">Add User</span>
                </button>
                <button
                    mat-flat-button
                    [color]="'primary'"

                    (click)="openRoleDialog()">
                    <mat-icon [svgIcon]="'heroicons_outline:plus'"></mat-icon>
                    <span class="ml-2">Add Role</span>
                </button>
            </div>
        </div>
        <div class="bg-card rounded-2xl shadow p-6 mb-8 mt-8">
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                <div *ngFor="let role of roles; trackBy: trackByFn" class="bg-gray-100 dark:bg-gray-800 rounded-lg p-4">
                    <div class="flex items-center justify-between mb-4">
                    <div>
                        <div class="font-medium">{{role.name}}</div>
                        <div class="text-sm text-gray-500">{{role.id}}</div>
                    </div>
                    <div class="flex items-center">
                        <button
                            mat-icon-button
                            [matTooltip]="'Edit'"
                            (click)="openRoleDialog(role)"
                        >
                            <mat-icon
                                class="icon-size-5"
                                [svgIcon]="'heroicons_solid:pencil'"
                            ></mat-icon>
                        </button>
                        <button
                            mat-icon-button
                            [matTooltip]="'Delete'"
                            (click)="deleteRole(role)"
                        >
                            <mat-icon
                                class="icon-size-5"
                                [svgIcon]="'heroicons_solid:trash'"
                            ></mat-icon>
                        </button>
                    </div>
                </div>

                <div class="flex items-center justify-between mb-2">
                    <div class="text-sm font-medium">Permissions:</div>
                </div>
                <div class="space-y-1 overflow-y-auto max-h-[100px]">
                    <div *ngFor="let permission of role.permissions" class="text-sm">
                        {{getPermissionDescription(permission)}}
                    </div>
                </div>
                </div>
            </div>
        </div>

            <!-- Users table -->
            <div class="bg-card rounded-2xl shadow">
                <table
                    mat-table
                    [dataSource]="users"
                    class="w-full"
                >
                    <!-- Name column -->
                    <ng-container matColumnDef="name">
                        <th mat-header-cell *matHeaderCellDef>Name</th>
                        <td mat-cell *matCellDef="let user">
                            <div class="flex items-center">
                                <div
                                    class="w-10 h-10 rounded-full overflow-hidden mr-4"
                                    *ngIf="user.avatar"
                                >
                                    <img
                                        [src]="user.avatar"
                                        [alt]="user.name"
                                    >
                                </div>
                                <div>{{user.name}}</div>
                            </div>
                        </td>
                    </ng-container>

                    <!-- Email column -->
                    <ng-container matColumnDef="email">
                        <th mat-header-cell *matHeaderCellDef>Email</th>
                        <td mat-cell *matCellDef="let user">{{user.email}}</td>
                    </ng-container>

                    <!-- Role column -->
                    <ng-container matColumnDef="role">
                        <th mat-header-cell *matHeaderCellDef>Role</th>
                        <td mat-cell *matCellDef="let user">
                            {{getRoleName(user.role)}}
                        </td>
                    </ng-container>

                    <!-- Actions column -->
                    <ng-container matColumnDef="actions">
                        <th mat-header-cell *matHeaderCellDef></th>
                        <td mat-cell *matCellDef="let user">
                            <div class="flex items-center justify-end">
                                <!-- Edit user permissions -->
                                <button
                                    *hasPermission="'edit_user'"
                                    mat-icon-button
                                    [matTooltip]="'Edit'"
                                    (click)="openUserPermissionsDialog(user)"
                                >
                                    <mat-icon
                                        class="icon-size-5"
                                        [svgIcon]="'heroicons_solid:pencil'"
                                    ></mat-icon>
                                </button>

                                <!-- Delete -->
                                <button
                                    *hasPermission="'delete_user'"
                                    mat-icon-button
                                    [matTooltip]="'Delete'"
                                >
                                    <mat-icon
                                        class="icon-size-5"
                                        [svgIcon]="'heroicons_solid:trash'"
                                    ></mat-icon>
                                </button>
                            </div>
                        </td>
                    </ng-container>

                    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                    <tr
                        mat-row
                        *matRowDef="let row; columns: displayedColumns;"
                    ></tr>
                </table>

                <!-- Paginator -->
                <mat-paginator
                    [pageSize]="10"
                    [pageSizeOptions]="[5, 10, 25, 100]"
                    showFirstLastButtons
                ></mat-paginator>
            </div>

    </div>
</div>